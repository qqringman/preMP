{% extends "base.html" %}

{% block title %}匯出報表 - SFTP 下載與比較系統{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/export_report.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-file-export"></i> 匯出報表
        </h1>
        <p class="page-subtitle">選擇任務並匯出為各種格式</p>
    </div>

    <!-- 報表選擇區塊 -->
    <div class="report-selector-section">
        <div class="section-header">
            <h2 class="step-title">選擇報表</h2>
        </div>
        
        <div class="section-content">
            <div class="selector-grid">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-tasks"></i> 選擇任務
                    </label>
                    <select class="form-select" id="taskSelector">
                        <option value="">載入中...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-table"></i> 選擇資料表
                    </label>
                    <select class="form-select" id="sheetSelector" disabled>
                        <option value="">請先選擇任務...</option>
                    </select>
                </div>
            </div>
            
            <!-- 任務摘要 -->
            <div id="taskSummary" style="margin-top: 24px;">
                <!-- 動態顯示任務統計 -->
            </div>
        </div>
    </div>

    <!-- 快速操作 -->
    <div class="quick-actions">
        <button class="btn-quick" onclick="quickExport('all-excel')">
            <i class="fas fa-file-excel"></i>
            <span>匯出所有 Excel</span>
        </button>
        <button class="btn-quick" onclick="quickExport('pdf')">
            <i class="fas fa-file-pdf"></i>
            <span>匯出 PDF 報告</span>
        </button>
        <button class="btn-quick" onclick="quickExport('html')">
            <i class="fas fa-file-code"></i>
            <span>匯出 HTML</span>
        </button>
        <button class="btn-quick" onclick="quickExport('zip')">
            <i class="fas fa-file-archive"></i>
            <span>下載完整包</span>
        </button>
    </div>

    <!-- 報表預覽區塊 -->
    <div class="report-preview-section">
        <div class="section-header">
            <h2 class="step-title">資料預覽</h2>
        </div>
        
        <div class="section-content">
            <!-- 資料表統計 -->
            <div id="sheetStatistics">
                <!-- 動態顯示統計 -->
            </div>
            
            <!-- 預覽容器 -->
            <div class="preview-container" id="previewContainer">
                <!-- 動態載入資料預覽 -->
            </div>
        </div>
    </div>

    <!-- 匯出選項區塊 -->
    <div class="export-options-section">
        <div class="section-header">
            <h2 class="step-title">匯出選項</h2>
        </div>
        
        <div class="export-formats">
            <div class="format-card excel" onclick="exportData('current-excel')">
                <div class="format-icon">
                    <i class="fas fa-file-excel"></i>
                </div>
                <div class="format-title">Excel (當前表)</div>
                <div class="format-desc">匯出當前選擇的資料表為 Excel 檔案</div>
            </div>
            
            <div class="format-card excel" onclick="exportData('all-excel')">
                <div class="format-icon">
                    <i class="fas fa-table"></i>
                </div>
                <div class="format-title">Excel (所有表)</div>
                <div class="format-desc">匯出所有資料表為單一 Excel 檔案</div>
            </div>
            
            <div class="format-card pdf" onclick="exportData('pdf')">
                <div class="format-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="format-title">PDF 報告</div>
                <div class="format-desc">產生格式化的 PDF 報告文件</div>
            </div>
            
            <div class="format-card html" onclick="exportData('html')">
                <div class="format-icon">
                    <i class="fas fa-file-code"></i>
                </div>
                <div class="format-title">HTML 網頁</div>
                <div class="format-desc">產生可在瀏覽器檢視的 HTML 檔案</div>
            </div>
            
            <div class="format-card zip" onclick="downloadFullReport()">
                <div class="format-icon">
                    <i class="fas fa-file-archive"></i>
                </div>
                <div class="format-title">完整壓縮包</div>
                <div class="format-desc">下載包含所有檔案的 ZIP 壓縮包</div>
            </div>
        </div>
        
        <div class="export-hint">
            <i class="fas fa-lightbulb"></i>
            <span>提示：您可以先預覽資料，確認內容正確後再進行匯出。所有匯出格式都會保留原始資料的完整性。</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/export_report.js') }}"></script>
{% endblock %}